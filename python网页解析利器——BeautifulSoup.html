<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="littlewhite" />
        <meta name="copyright" content="littlewhite" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, beautifulsoup, Language, " />

<meta property="og:title" content="python网页解析利器——BeautifulSoup "/>
<meta property="og:url" content="/python网页解析利器——BeautifulSoup.html" />
<meta property="og:description" content="python解析网页，无出BeautifulSoup左右，此是序言 安装¶ BeautifulSoup4以后的安装需要用eazy_install，如果不需要最新的功能，安装版本3就够了，千万别以为老版本就怎么怎么不好，想当初也是千万人在用的啊。安装很简单 wget &#34;http://www.crummy.com/software/BeautifulSoup/download/3.x/BeautifulSoup-3.2.1.tar.gz&#34; tar zxvf BeautifulSoup-3.2.1.tar.gz 然后把里面的BeautifulSoup.py这个文件放到你python安装目录下的site-packages目录下 site-packages是存放Python第三方包的地方，至于这个目录在什么地方呢，每个系统不一样，可以用下面的方式找一下，基本上都能找到 sudo find / -name &#34;site-packages&#34; -maxdepth 5 -type d 当然如果没有root权限就查找当前用户的根目录 find ~ -name ..." />
<meta property="og:site_name" content="LittleWhite" />
<meta property="og:article:author" content="littlewhite" />
<meta property="og:article:published_time" content="2014-03-21T00:00:00+08:00" />
<meta property="" content="2014-03-21T00:00:00+08:00" />
<meta name="twitter:title" content="python网页解析利器——BeautifulSoup ">
<meta name="twitter:description" content="python解析网页，无出BeautifulSoup左右，此是序言 安装¶ BeautifulSoup4以后的安装需要用eazy_install，如果不需要最新的功能，安装版本3就够了，千万别以为老版本就怎么怎么不好，想当初也是千万人在用的啊。安装很简单 wget &#34;http://www.crummy.com/software/BeautifulSoup/download/3.x/BeautifulSoup-3.2.1.tar.gz&#34; tar zxvf BeautifulSoup-3.2.1.tar.gz 然后把里面的BeautifulSoup.py这个文件放到你python安装目录下的site-packages目录下 site-packages是存放Python第三方包的地方，至于这个目录在什么地方呢，每个系统不一样，可以用下面的方式找一下，基本上都能找到 sudo find / -name &#34;site-packages&#34; -maxdepth 5 -type d 当然如果没有root权限就查找当前用户的根目录 find ~ -name ...">

        <title>python网页解析利器——BeautifulSoup  · LittleWhite
</title>
        <!-- 
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        --!>
        <link href="/theme/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="/theme/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="/theme/css/custom.css" media="screen">
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="/"><span class=site-name>LittleWhite</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="">Home</a></li>
                            <li ><a href="/categories.html">Categories</a></li>
                            <li ><a href="/tags.html">Tags</a></li>
                            <li ><a href="/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="/python网页解析利器——BeautifulSoup.html"> python网页解析利器——BeautifulSoup  </a></h1>
    </header>
</div>

<div class="row-fluid">
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        <div class="toc">
<ul>
<li><a href="#_1">安装</a></li>
<li><a href="#_2">使用</a><ul>
<li><a href="#_3">初始化</a></li>
<li><a href="#_4">查找节点</a><ul>
<li><a href="#_5">单个节点</a><ul>
<li><a href="#_6">根据节点名</a></li>
<li><a href="#_7">根据属性</a></li>
<li><a href="#_8">根据节点关系</a></li>
</ul>
</li>
<li><a href="#_9">多个节点</a><ul>
<li><a href="#_10">根据节点名</a></li>
<li><a href="#_11">根据属性查找</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_12">获取文本</a></li>
</ul>
</li>
<li><a href="#_13">实战</a></li>
</ul>
</div>
        </nav>
    </div>
    <div class="span8 article-content">
            
            
<blockquote>
<p>python解析网页，无出BeautifulSoup左右，此是序言</p>
</blockquote>
<h2 id="_1">安装<a class="headerlink" href="#_1" title="Permanent link">¶</a></h2>
<p>BeautifulSoup4以后的安装需要用eazy_install，如果不需要最新的功能，安装版本3就够了，千万别以为老版本就怎么怎么不好，想当初也是千万人在用的啊。安装很简单</p>
<div class="highlight"><pre><span></span>wget "http://www.crummy.com/software/BeautifulSoup/download/3.x/BeautifulSoup-3.2.1.tar.gz"
tar zxvf BeautifulSoup-3.2.1.tar.gz
</pre></div>
<p>然后把里面的BeautifulSoup.py这个文件放到你python安装目录下的site-packages目录下
site-packages是存放Python第三方包的地方，至于这个目录在什么地方呢，每个系统不一样，可以用下面的方式找一下，基本上都能找到</p>
<div class="highlight"><pre><span></span>sudo find / -name "site-packages" -maxdepth 5 -type d
</pre></div>
<p>当然如果没有root权限就查找当前用户的根目录</p>
<div class="highlight"><pre><span></span>find ~ -name "site-packages" -maxdepth 5 -type d
</pre></div>
<p>如果你用的是Mac，哈哈，你有福了，我可以直接告诉你，Mac的这个目录在/Library/Python/下，这个下面可能会有多个版本的目录，没关系，放在最新的一个版本下的site-packages就行了。使用之前先import一下</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</pre></div>
<h2 id="_2">使用<a class="headerlink" href="#_2" title="Permanent link">¶</a></h2>
<p>在使用之前我们先来看一个实例
现在给你这样一个页面</p>
<p><a href="http://movie.douban.com/tag/%E5%96%9C%E5%89%A7">http://movie.douban.com/tag/%E5%96%9C%E5%89%A7</a></p>
<p>它是豆瓣电影分类下的喜剧电影，如果让你找出里面评分最高的100部，该怎么做呢
好了，我先晒一下我做的，鉴于本人在CSS方面处于小白阶段以及天生没有美术细菌，界面做的也就将就能看下，别吐</p>
<p><a href="http://littlewhite.us/douban/xiju/">http://littlewhite.us/douban/xiju/</a></p>
<p>接下来我们开始学习BeautifulSoup的一些基本方法，做出上面那个页面就易如反掌了 鉴于豆瓣那个页面比较复杂，我们先以一个简单样例来举例，假设我们处理如下的网页代码</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Page title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">"firstpara"</span> <span class="na">align</span><span class="o">=</span><span class="s">"center"</span><span class="p">&gt;</span>
    This is paragraph
        <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>
        one
        <span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
        .
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span> <span class="na">id</span><span class="o">=</span><span class="s">"secondpara"</span> <span class="na">align</span><span class="o">=</span><span class="s">"blah"</span><span class="p">&gt;</span>
    This is paragraph
        <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;</span>
        two
        <span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
        .
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p>你没看错，这就是官方文档里的一个样例，如果你有耐心，看官方文档就足够了，后面的你都不用看</p>
<p><a href="http://www.leeon.me/upload/other/beautifulsoup-documentation-zh.html">http://www.leeon.me/upload/other/beautifulsoup-documentation-zh.html</a></p>
<h3 id="_3">初始化<a class="headerlink" href="#_3" title="Permanent link">¶</a></h3>
<p>首先将上面的HTML代码赋给一个变量html如下，为了方便大家复制这里贴的是不带回车的，上面带回车的代码可以让大家看清楚HTML结构</p>
<div class="highlight"><pre><span></span>html = '<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>Page title<span class="nt">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p</span> <span class="na">id=</span><span class="s">"firstpara"</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>This is paragraph<span class="nt">&lt;b&gt;</span>one<span class="nt">&lt;/b&gt;</span>.<span class="nt">&lt;/p&gt;&lt;p</span> <span class="na">id=</span><span class="s">"secondpara"</span> <span class="na">align=</span><span class="s">"blah"</span><span class="nt">&gt;</span>This is paragraph<span class="nt">&lt;b&gt;</span>two<span class="nt">&lt;/b&gt;</span>.<span class="nt">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span>'
</pre></div>
<p>初始化如下：</p>
<div class="highlight"><pre><span></span>soup = BeautifulSoup(html)
</pre></div>
<p>我们知道HTML代码可以看成一棵树，这个操作等于是把HTML代码解析成一种树型的数据结构并存储在soup中，注意这个数据结构的根节点不是<html>，而是soup，其中html标签是soup的唯一子节点，不信你试试下面的操作</html></p>
<div class="highlight"><pre><span></span>print soup
print soup.contents[0]
print soup.contents[1]
</pre></div>
<p>前两个输出结果是一致的，就是整个html文档，第三条输出报错IndexError: list index out of range</p>
<h3 id="_4">查找节点<a class="headerlink" href="#_4" title="Permanent link">¶</a></h3>
<p>查找节点有两种反回形式，一种是返回单个节点，一种是返回节点list，对应的查找函数分别为find和findAll</p>
<h4 id="_5">单个节点<a class="headerlink" href="#_5" title="Permanent link">¶</a></h4>
<h5 id="_6">根据节点名<a class="headerlink" href="#_6" title="Permanent link">¶</a></h5>
<div class="highlight"><pre><span></span>## 查找head节点
print soup.find('head') ## 输出为<span class="nt">&lt;head&gt;&lt;title&gt;</span>Page title<span class="nt">&lt;/title&gt;&lt;/head&gt;</span>
## or
## head = soup.head
</pre></div>
<p>这种方式查找到的是待查找节点最近的节点，比如这里待查找节点是soup，这里找到的是离soup最近的一个head（如果有多个的话）</p>
<h5 id="_7">根据属性<a class="headerlink" href="#_7" title="Permanent link">¶</a></h5>
<div class="highlight"><pre><span></span> ## 查找id属性为firstpara的节点
 print soup.find(attrs={'id':'firstpara'})  
 ## 输出为<span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"firstpara"</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>This is paragraph<span class="nt">&lt;b&gt;</span>one<span class="nt">&lt;/b&gt;</span>.<span class="nt">&lt;/p&gt;</span>
 ## 也可节点名和属性进行组合
 print soup.find('p', attrs={'id':'firstpara'})  ## 输出同上
</pre></div>
<h5 id="_8">根据节点关系<a class="headerlink" href="#_8" title="Permanent link">¶</a></h5>
<p>节点关系无非就是兄弟节点，父子节点这样的</p>
<div class="highlight"><pre><span></span> p1 = soup.find(attrs={'id':'firstpara'}) ## 得到第一个p节点
 print p1.nextSibling ## 下一个兄弟节点
 ## 输出<span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"secondpara"</span> <span class="na">align=</span><span class="s">"blah"</span><span class="nt">&gt;</span>This is paragraph<span class="nt">&lt;b&gt;</span>two<span class="nt">&lt;/b&gt;</span>.<span class="nt">&lt;/p&gt;</span>
 p2 = soup.find(attrs={'id':'secondpara'}) ## 得到第二个p节点
 print p2.previousSibling ## 上一个兄弟节点
 ## 输出<span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"firstpara"</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>This is paragraph<span class="nt">&lt;b&gt;</span>one<span class="nt">&lt;/b&gt;</span>.<span class="nt">&lt;/p&gt;</span>
 print p2.parent ## 父节点，输出太长这里省略部分 <span class="nt">&lt;body&gt;</span>...<span class="nt">&lt;/body&gt;</span>
 print p2.contents[0] ## 第一个子节点，输出u'This is paragraph'
</pre></div>
<p>contents上面已经提到过，它存储的是所有子节点的序列</p>
<h4 id="_9">多个节点<a class="headerlink" href="#_9" title="Permanent link">¶</a></h4>
<p>将上面介绍的find改为findAll即可返回查找到的节点列表，所需参数都是一致的</p>
<h5 id="_10">根据节点名<a class="headerlink" href="#_10" title="Permanent link">¶</a></h5>
<div class="highlight"><pre><span></span>## 查找所有p节点
soup.findAll('p')
</pre></div>
<h5 id="_11">根据属性查找<a class="headerlink" href="#_11" title="Permanent link">¶</a></h5>
<div class="highlight"><pre><span></span>## 查找id=firstpara的所有节点
soup.findAll(attrs={'id':'firstpara'}) 
</pre></div>
<p>需要注意的是，虽然在这个例子中只找到一个节点，但返回的仍是一个列表对象</p>
<p>上面的这些基本查找功能已经可以应付大多数情况，如果需要各个高级的查找，比如正则式，可以去看官方文档</p>
<h3 id="_12">获取文本<a class="headerlink" href="#_12" title="Permanent link">¶</a></h3>
<p>getText方法可以获取节点下的所有文本，其中可以传递一个字符参数，用来分割每个各节点之间的文本</p>
<div class="highlight"><pre><span></span>## 获取head节点下的文本
soup.head.getText()         ## u'Page title'
## or
soup.head.text
## 获取body下的所有文本并以\n分割
soup.body.getText('\n')     ## u'This is paragraph\none\n.\nThis is paragraph\ntwo\n.'
</pre></div>
<h2 id="_13">实战<a class="headerlink" href="#_13" title="Permanent link">¶</a></h2>
<p>有了这些功能，文章开头给出的那个Demo就好做了，我们再来回顾下豆瓣的这个页面</p>
<p><a href="http://movie.douban.com/tag/%E5%96%9C%E5%89%A7">http://movie.douban.com/tag/%E5%96%9C%E5%89%A7</a></p>
<p>如果要得到评分前100的所有电影，对这个页面需要提取两个信息：1、翻页链接；2、每部电影的信息（外链，图片，评分、简介、标题等）</p>
<p>当我们提取到所有电影的信息后再按评分进行排序，选出最高的即可，这里贴出翻页提取和电影信息提取的代码</p>
<div class="highlight"><pre><span></span><span class="c1">## filename: Grab.py</span>
<span class="kn">from</span> <span class="nn">BeautifulSoup</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span><span class="p">,</span> <span class="n">Tag</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">Log</span> <span class="kn">import</span> <span class="n">LOG</span>

<span class="k">def</span> <span class="nf">LOG</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="o">*</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Grab</span><span class="p">():</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">GetPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s1">'http://'</span> <span class="o">+</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">LOG</span><span class="p">(</span><span class="s1">'input url is: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">'User-Agent'</span> <span class="p">:</span> <span class="s2">"Magic Browser"</span><span class="p">})</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">page</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="n">page</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  

    <span class="k">def</span> <span class="nf">ExtractInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">buf</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">LOG</span><span class="p">(</span><span class="s1">'soup failed in ExtractInfo :</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'item'</span><span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">LOG</span><span class="p">(</span><span class="s1">'failed on find items:</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="p">[]</span> 
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">intros</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pic</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'nbg'</span><span class="p">})</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">pic</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">pic</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="s1">'src'</span><span class="p">]</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'pl2'</span><span class="p">})</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">'[ </span><span class="se">\t</span><span class="s1">]+'</span><span class="p">,</span><span class="s1">' '</span><span class="p">,</span><span class="n">info</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'&amp;amp;nbsp'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">,</span><span class="s1">''</span><span class="p">))</span>
                <span class="n">star</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'star clearfix'</span><span class="p">})</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'rating_nums'</span><span class="p">})</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'&amp;amp;nbsp'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
                <span class="n">comment</span> <span class="o">=</span> <span class="n">star</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'pl'</span><span class="p">})</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'&amp;amp;nbsp'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
                <span class="n">intro</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'pl'</span><span class="p">})</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'&amp;amp;nbsp'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">LOG</span><span class="p">(</span><span class="s1">'process error in ExtractInfo: </span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">links</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
            <span class="n">objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>    
            <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
            <span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
            <span class="n">intros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intro</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">intros</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ExtractPageTurning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">buf</span><span class="p">):</span>
        <span class="n">links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">LOG</span><span class="p">(</span><span class="s1">'soup failed in ExtractPageTurning:</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pageturning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">attrs</span><span class="o">=</span><span class="p">{</span><span class="s1">'class'</span><span class="p">:</span><span class="s1">'paginator'</span><span class="p">})</span>
            <span class="n">a_nodes</span> <span class="o">=</span> <span class="n">pageturning</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">'a'</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a_node</span> <span class="ow">in</span> <span class="n">a_nodes</span><span class="p">:</span>
                <span class="n">href</span> <span class="o">=</span> <span class="n">a_node</span><span class="p">[</span><span class="s1">'href'</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">href</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">'http://'</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">href</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'?'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">href</span>
                <span class="n">links</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">href</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">LOG</span><span class="p">(</span><span class="s1">'get pageturning failed in ExtractPageTurning:</span><span class="si">%s</span><span class="s1">'</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">links</span>

    <span class="k">def</span> <span class="nf">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">soup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soup</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
<p>接着我们再来写个测试样例</p>
<div class="highlight"><pre><span></span><span class="c1">## filename: test.py</span>
<span class="c1">#encoding: utf-8</span>
<span class="kn">from</span> <span class="nn">Grab</span> <span class="kn">import</span> <span class="n">Grab</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>

<span class="n">grab</span> <span class="o">=</span> <span class="n">Grab</span><span class="p">()</span>
<span class="n">buf</span> <span class="o">=</span> <span class="n">grab</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="s1">'http://movie.douban.com/tag/喜剧?start=160&amp;amp;type=T'</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">buf</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">'GetPage failed!'</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="n">links</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">intros</span> <span class="o">=</span> <span class="n">grab</span><span class="o">.</span><span class="n">ExtractInfo</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="k">for</span> <span class="n">link</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">intro</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">objs</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">scores</span><span class="p">,</span> <span class="n">comments</span><span class="p">,</span> <span class="n">intros</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">link</span><span class="o">+</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">+</span><span class="n">obj</span><span class="o">+</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">+</span><span class="n">score</span><span class="o">+</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">+</span><span class="n">comment</span><span class="o">+</span><span class="s1">'</span><span class="se">\t</span><span class="s1">'</span><span class="o">+</span><span class="n">intro</span>
<span class="n">pageturning</span> <span class="o">=</span> <span class="n">grab</span><span class="o">.</span><span class="n">ExtractPageTurning</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">pageturning</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">link</span>
<span class="n">grab</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</pre></div>
<p>OK，完成这一步接下来的事儿就自个看着办吧  </p>
<p>本文只是介绍了BeautifulSoup的皮毛而已，目的是为了让大家快速学会一些基本要领，想当初我要用什么功能都是去BeautifulSoup的源代码里一个函数一个函数看然后才会的，一把辛酸泪啊，所以希望后来者能够通过更便捷的方式去掌握一些基本功能，也不枉我一字一句敲出这篇文章，尤其是这些代码的排版，真是伤透了脑筋</p>
<p>The end.</p>
            
            
            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="next-article"><a href="/wordpress自定义页面显示所有文章列表.html" title="Next: wordpress自定义页面显示所有文章列表">wordpress自定义页面显示所有文章列表</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <table class="table">
            <!-- <time pubdate="pubdate" datetime="2014-03-21T00:00:00+08:00"> 3 21, 2014</time> -->
            <tr>
                <td>Published</td>
                <td><time pubdate="pubdate" datetime="2014-03-21T00:00:00+08:00">2014- 3-21</time></td>
            </tr>
            <tr>
                <td>Category</td>
                <td><a class="category-link" href="/categories.html#language-ref">Language</a></td>
            </tr>
            <tr>
                <td>Tags</td>
                <td>
                    <ul class="list-of-tags tags-in-article">
                        <li><a href="/tags.html#beautifulsoup-ref">beautifulsoup
                            <span>1</span>
</a></li>
                        <li><a href="/tags.html#python-ref">python
                            <span>6</span>
</a></li>
                    </ul>
                </td>
            </tr>
            </table>
        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <!--
        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        -->
        <script src="/theme/js/jquery.min.js"></script>
        <script src="/theme/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script>
            $("div.article-content table").addClass("table table-hover");
        </script>

    
    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>